{% extends 'base.html' %}

{% block content %}
<div class="container mx-auto px-4 py-8">

    <div class="flex flex-col md:flex-row justify-between items-center mb-8">
        <h1 class="text-3xl font-bold text-gray-800">
            📅 Розклад занять {% if group %}- {{ group.name }}{% endif %}
        </h1>

        {% if user.role != 'student' %}
        <form method="get" class="mt-4 md:mt-0 flex items-center">
            <select name="group_id" onchange="this.form.submit()"
                class="border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 p-2">
                <option value="">-- Оберіть групу --</option>
                {% for g in all_groups %}
                <option value="{{ g.id }}" {% if group.id == g.id %}selected{% endif %}>{{ g.name }}</option>
                {% endfor %}
            </select>
        </form>
        {% endif %}
    </div>

    {% if group %}
    <div class="bg-white rounded-xl shadow-lg overflow-hidden border border-gray-200">
        <div class="overflow-x-auto">
            <div class="min-w-[800px]">
                <div class="grid grid-cols-6 bg-gray-50 border-b border-gray-200">
                    <div class="p-4 text-center font-bold text-gray-500 uppercase tracking-wider text-xs">Час</div>
                    {% for day in days_header %}
                    <div
                        class="p-4 text-center font-bold text-gray-700 uppercase tracking-wider text-sm border-l border-gray-200">
                        {{ day }}
                    </div>
                    {% endfor %}
                </div>

                {% for lesson_num, info in schedule_data.items %}
                <div class="grid grid-cols-6 border-b border-gray-100 hover:bg-gray-50 transition duration-150">

                    <div class="p-4 flex flex-col justify-center items-center border-r border-gray-200 bg-gray-50/50">
                        <span class="text-lg font-bold text-gray-800">{{ lesson_num }}</span>
                        <div class="text-xs text-gray-500 font-mono mt-1">
                            {{ info.time.start }}<br>
                            {{ info.time.end }}
                        </div>
                    </div>

                    {% for day_num, assignment in info.days.items %}
                    <div class="relative p-2 border-l border-gray-100 min-h-[100px] flex flex-col">
                        {% if assignment %}
                        <div
                            class="flex-1 bg-blue-50 border-l-4 border-blue-500 rounded p-3 shadow-sm hover:shadow-md transition cursor-pointer group">

                            <div class="font-bold text-blue-900 text-sm leading-tight mb-1">
                                {{ assignment.subject.name }}
                            </div>

                            <div class="text-xs text-gray-600 mb-2 flex items-center">
                                <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                                </svg>
                                {{ assignment.teacher.full_name|truncatechars:15 }}
                            </div>

                            <div class="mt-auto">
                                <span
                                    class="inline-block px-2 py-0.5 rounded text-[10px] font-semibold bg-blue-200 text-blue-800">
                                    Аудиторія 30{{ lesson_num }}
                                </span>
                            </div>

                            <div
                                class="absolute z-10 hidden group-hover:block bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-48 bg-gray-900 text-white text-xs rounded p-2 shadow-xl">
                                <strong>{{ assignment.subject.name }}</strong><br>
                                Викладач: {{ assignment.teacher.full_name }}<br>
                                Час: {{ info.time.start }} - {{ info.time.end }}
                            </div>
                        </div>
                        {% else %}
                        <div class="h-full flex items-center justify-center opacity-0 hover:opacity-100">
                            <span class="text-gray-300 text-xs select-none">Вікно</span>
                        </div>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
                {% endfor %}

            </div>
        </div>
    </div>
    {% else %}
    <div class="text-center py-12 bg-gray-100 rounded-lg border-2 border-dashed border-gray-300">
        <p class="text-gray-500 text-xl">Оберіть групу для перегляду розкладу</p>
    </div>
    {% endif %}
</div>
{% endblock %}